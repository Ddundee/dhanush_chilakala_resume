name: Build and Release Resume
on:
  push:
    branches: [ main, master ]
    paths: [ '**.tex' ]

permissions:
  contents: write  # Required to create releases

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Install TeX Live
        run: |
          sudo apt-get update
          sudo apt-get install -y texlive-latex-base texlive-fonts-recommended texlive-fonts-extra texlive-latex-extra latexmk
        
      - name: Build PDF
        run: |
          latexmk -pdf -quiet resume.tex
          # Ensure consistent naming for the output
          cp resume.pdf dhanush_chilakala_resume.pdf
          
      - name: Upload PDF artifact (for download in Actions)
        uses: actions/upload-artifact@v4
        with:
          name: resume-pdf
          path: dhanush_chilakala_resume.pdf
          
      - name: Delete existing latest release
        run: |
          # Delete the release and tag if they exist
          gh release delete latest --yes || true
          git push --delete origin latest || true
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Create new latest release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: latest
          name: "Latest Resume - $(date +'%Y-%m-%d %H:%M UTC')"
          body: |
            ## �� Dhanush Chilakala - Resume
            
            **Auto-generated on:** $(date +'%Y-%m-%d at %H:%M UTC')
            **Commit:** ${{ github.sha }}
            
            ### �� Direct PDF Link:
            ```
            https://github.com/${{ github.repository }}/releases/download/latest/dhanush_chilakala_resume.pdf
            ```
            
            ### �� Changes in this build:
            - LaTeX source updated
            - PDF automatically compiled and released
            
            ---
            *This release is automatically updated whenever the resume LaTeX files are modified.*
          files: dhanush_chilakala_resume.pdf
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}